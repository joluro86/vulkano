{% extends 'index.html' %}

{% block breadcrumb %}
  {% include 'breadcrumb.html' with home='/' breadcrumbs=breadcrumb_items %}
{% endblock %}

{% block content %}
  <div class="max-w-5xl mx-auto mt-6 bg-white p-6 rounded shadow">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold text-gray-800">Alquiler #{{ alquiler.id }}</h2>
      <a href="{% url 'alquiler_list' %}" class="text-sm text-[var(--primary-color)] hover:underline">‚Üê Volver al listado</a>
    </div>

    <!-- Secci√≥n encabezado compacto -->
    <form method="post" class="mb-4">
      {% csrf_token %}
      <div class="flex flex-wrap gap-4 items-end">
        <div class="flex-1 min-w-[200px]">
          <label class="block text-sm font-medium text-gray-700">Fecha de inicio</label>
          {{ form.fecha_inicio }}
        </div>
        <div class="flex-1 min-w-[200px]">
          <label class="block text-sm font-medium text-gray-700">Fecha de fin</label>
          {{ form.fecha_fin }}
        </div>
        <div class="flex-1 min-w-[200px]">
          <button type="submit" class="w-full bg-[var(--primary-color)] text-white py-2 px-4 rounded hover:bg-blue-700 transition">Guardar cambios</button>
        </div>
      </div>

      <div class="mt-2">
        <button type="button" id="toggle-observacion" class="text-sm text-[var(--primary-color)] hover:underline">üìù Agregar observaci√≥n</button>
      </div>

      <div id="observacion-campo" class="mt-2 hidden">
        <label class="block text-sm font-medium text-gray-700">Observaciones</label>
        {{ form.observaciones }}
      </div>
    </form>

    <!-- Secci√≥n para agregar productos al alquiler -->
    <div class="border-t border-gray-200 pt-4 mt-6">
      <h3 class="text-xl font-semibold text-gray-800 mb-2">Agregar producto al alquiler</h3>
      <form method="post" action="{% url 'editar_alquiler' alquiler.id %}" class="grid grid-cols-3 gap-4 items-end">
        {% csrf_token %}
        {{ item_form.non_field_errors }}

        <div>
          <label class="block text-sm font-medium text-gray-700">Producto</label>
          {{ item_form.producto }}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">D√≠as a cobrar</label>
          {{ item_form.dias_a_cobrar }}
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Precio por d√≠a</label>
          {{ item_form.precio_dia }}
        </div>
        <div class="col-span-3">
          <button type="submit" class="mt-2 w-full bg-[var(--primary-color)] text-white py-2 rounded hover:bg-blue-700 transition">Agregar producto</button>
        </div>
      </form>
    </div>

    <!-- Tabla de productos a√±adidos -->
    <div class="mt-6">
      <h3 class="text-xl font-semibold text-gray-800 mb-2">Productos del alquiler</h3>
      <table class="min-w-full bg-white border border-gray-300 rounded">
        <thead class="bg-gray-100">
          <tr>
            <th class="text-left p-2">Producto</th>
            <th class="text-left p-2">D√≠as</th>
            <th class="text-left p-2">Precio/d√≠a</th>
            <th class="text-left p-2">Valor total</th>
            <th class="text-left p-2">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for item in alquiler.items.all %}
            <tr class="border-t">
              <td class="p-2">{{ item.producto }}</td>
              <td class="p-2">{{ item.dias_a_cobrar }}</td>
              <td class="p-2">${{ item.precio_dia|floatformat:0 }}</td>
              <td class="p-2 font-semibold">${{ item.valor_item|floatformat:0 }}</td>
              <td class="p-2 text-sm text-red-600">
                <a href="{% url 'eliminar_item_alquiler' item.id %}" class="hover:underline">Eliminar</a>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="5" class="p-2 text-center text-gray-500">A√∫n no se han agregado productos.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Script para mostrar/ocultar observaci√≥n -->
  <script>
    const btnObs = document.getElementById('toggle-observacion')
    const campoObs = document.getElementById('observacion-campo')
    
    btnObs.addEventListener('click', () => {
      campoObs.classList.toggle('hidden')
    })
  </script>
{% endblock %}
